\documentclass[12pt]{article}

\usepackage[margin=1in]{geometry}  % set the margins to 1in on all sides
\usepackage{graphicx}              % to include figures
\usepackage{amsmath, bm}               % great math stuff
\usepackage{amsfonts}              % for blackboard bold, etc
\usepackage{amsthm}                % better theorem environments
\usepackage{hyperref}
\usepackage{natbib}
\usepackage{pdfpages}
\usepackage{booktabs}
\usepackage{multirow}

%% \usepackage{caption}
%% \captionsetup{justification=justified}

\newcommand{\kron}{\raisebox{1pt}{\ensuremath{\:\otimes\:}}} 
\newcommand{\lgamma}{\text{lgamma}} 
\newcommand{\digamma}{\text{digamma}} 

\bibliographystyle{plainnat}

\begin{document}

\nocite{*}

\title{Calibrating the pollen-vegetation relationship}

\author{Andria Dawson, Christopher Paciorek, Jason McLachlan,\\ Simon Goring, John Williams, Stephen Jackson}

\maketitle

\section{Introduction}

Understanding forest ecosystems of the past provides valuable
information about how these ecosystems respond to biotic and abiotic
factors at timescales outside the realm of most direct ecological
observations. In particular, in a world of changing climates,
reconstructing past shifts in tree distributions and forest
composition provides new information about climatic processes
governing forest distributions and dynamics \citep{goring2015a},
and vegetation-atmosphere feedbacks \citep{matthes2015}. The
fossil pollen records extracted from lakes and mires are our primary
source of data about prehistoric forest composition. Rigorous
estimates of past forest composition and forest dynamics from these
records relies on our ability to quantify the pollen-vegetation
relationship.

Key challenges to quantitative reconstructions of past vegetation from
pollen data are 1) the complex nature of the pollen-vegetation
relationship and 2) the heavy anthropogenic imprint on contemporary
plant communities.  The processes governing pollen production,
transport, and deposition have been the subject of palynological study
for decades \citep{tauber1965, jackson1994pollen, jackson1999pollen,
  sugita2007theory1, sugita2007theory2, prentice1988records}. The
pollen found in lakes and mires usually arrives by wind, from plants
that vary in their pollen productivity, the dispersibility of pollen
grains, and transport vector.  As a result, some plant species are
highly overrepresented in sedimentary archives and most are
underrepresented or absent.  A wide variety of pollen-vegetation
models (PVMs) have been developed including modern-analog based
approaches \citep{williams2003variations}, linear-regression
\citep{webb1981estimating}, mechanistic models of pollen transport
\citep{sugita2007theory1, sugita2007theory2, prentice1988records},
and, most recently, Bayesian hierarchical models
\citep{paciorek2009mapping, garreta2010method}. In these Bayesian
models, pollen counts from a network of ponds are modelled as a
function of gridded forest composition data, taking into account
pollen dispersal from both local and non-local vegetation,
differential pollen production, and process uncertainty. Using a
Bayesian hierarchical model allows borrowing of information across
space to estimate governing parameters at a regional scale, and to
estimate the uncertainty associated with these parameters.

Some PVMs, notably the LOVE/REVEALS family of models
\citep{sugita2007theory1, sugita2007theory2}, are calibrated using
information about pollen productivity and dispersal traits for
individual species and diffusion-based models of particulate
transport.  Other PVMs are calibrated against spatial networks of
pollen assemblages extracted from surface sediment samples, which are
then cross-referenced to contemporary spatial datasets of vegetation
composition and abundance of the surrounding forests. These
cross-referenced pollen and vegetation datasets are then use to make
inferences about the processes that affect pollen production,
dispersal, and deposition at the time of sampling. However, extending
any inference about these processes to times prior to the time of
sampling requires the assumption that pollen-vegetation relationships
are stationary.  This assumption of stationarity is questionable given
that the contemporary landscape has been heavily modified by human
land use.  This land-use has transformed the composition and structure
of contemporary forests and likely altered vegetation-pollen
relationships for some taxa \citep{kujawa2015}, perhaps by altering
microclimatic factors including wind dynamics.  Pollen-based
paleoclimate reconstructions in Minnesota have a demonstrated bias if
modern calibration datasets are used instead of pre-settlement
datasets \citep{st2014bias}. Hence, any PVM that is calibrated using
contemporary datasets may carry implicit and difficult-to-quantify
biases when applied to make inferences about vegetation composition
for time periods with less intensive land use.  To circumvent these
issues, we calibrate the pollen-vegetation relationship using newly
developed datasets of forest composition and sediment pollen data that
pre-dates European settlement, thereby avoiding the effects of
settlement, agriculture, and industrialization.

These datasets are based on US Public Land Survey (PLS) records
collected by surveyors prior to European settlement
\citep{bourdo1956review, schulte2001original}.

To calibrate the pollen-vegetation relationship against the PLS forest
composition data requires that we identify pollen samples that
correspond to the pre-settlement era. These fossil pollen samples are
drawn from longer sequences that typically come from lakes or
peatlands, and consist of a series of depths and associated pollen
counts broken down by taxon. Most pollen records also have radiocarbon
dates of organic materials scattered along the core at locations not
necessarily aligned with pollen counts. Other age controls include
other radiometric dates (e.g. 210Pb), biostratigraphic markers
(e.g. the rise in Ambrosia and other weedy taxa during EuroAmerican
settlement), and geostratigraphic markers such as the core top whose
age typically corresponds with the year of sampling. These age
controls are then used to constrain age-depth models that allow
inference of age at any depth throughout the core. However, inferred
ages are uncertain, due to analytical errors during the laboratory
radiocarbon dating process \citep{ward1978procedures}, the conversion
of radiocarbon to calendar years \citep{reimer2013intcal13}, and
potential differences between age of macrofossil material and age of
sediment \citep{blois2011methodological}. As in ecology, Bayesian
hierarchical modeling approaches to age-depth models are rapidly
gaining popularity for their ability to accommodate irregular
probability distribution functions, multiple sources of uncertainty,
and prior information \citep{blaauw2011flexible, buck1999bcal,
  blaauw2005radiocarbon, ramsey1995radiocarbon}.

During European settlement, land-clearances led to noticeable
increases in certain agricultural indicators that is reflected in the
pollen records, especially \textit{Ambrosia}
\citep{mcandrews1988human}. This change in relative composition of
\textit{Ambrosia}, referred to as the \textit{Ambrosia rise}, can be
used to identify the pollen sample that best corresponds with
pre-settlement - the pre-settlement pollen sample is the sample
immediately prior to the first pollen sample that reflects the
\textit{Ambrosia rise}. The presence of an established
biostratigraphic marker at the time of settlement eliminates the need
to rely on uncertain age-depth models. However, time series of pollen
counts are noisy, and in practice it can be difficult to precisely
identify the settlement horizon. We deal with the uncertainty
associated with \textit{Ambrosia rise} identification using expert
elicitation. 

% Calibrating the pollen-vegetation relationship using a process-based
% statistical model informs us about the key regional-scale processes,
% including differential production and dispersal, that transport pollen
% from the tree to the sediment. Results from this calibration model are
% a first step towards reconstructing past vegetation composition for
% the US Upper Midwest. Using pre-settlement calibration data allows us
% to more confidently assume that the pollen-vegetation relationship is
% static back through time, at least up to a point. 

Here, we refine and calibrate a Bayesian hierarchical PVM, based on
the STEPPS model \citep{paciorek2009mapping}, using newly developed
settlement-era pollen and vegetation calibration datasets for the
Upper Midwest.  Specific advances include the building of a
pre-settlement era identification of pre-settlement pollen samples
from pollen time series through expert elicitation and the testing and
comparison of two standard isometric dispersal kernels.  We apply
modelling results to develop new estimates of relative pollen
productivity and source area, assess the relative importance of local
and non-local pollen sources, and compare these results to prior
estimates of source area and pollen productivity.  This work lays the
methodological foundation for rigorous reconstruction of past forest
composition from fossil pollen data and all scripts are made publicly
available at GitHub.

\section{Data}

\subsection{Spatial domain}

Our study area is the upper Midwestern US, including Minnesota,
Wisconsin, and Michigan.  This region includes two major ecotones: the
``Tension Zone'' between northern mixed forests and temperature
broadleaved deciduous forests and the prairie/forest/savanna ecotone.
Both of these ecotones have been heavily modified by contemporary land
use \citep{goring2015b}.


\subsection{Public Land Survey (PLS) data}

%XXX Jack and Simon 
Prior to major European settlement, the US General Land Office
conducted a Public Land Survey (PLS) throughout much of the United
States to simplify the sale of federal lands. Surveyors
documented section locations using trees as landmarks, and recorded
genus or species, diameter, and location (azimuth and distance from
corner). This data set provides a systematic survey of the forest
before settlement, and has been used by foresters, ecologists, and
historians to understand ecosystem and land-use change through
time. In the Upper Midwest, the survey was conducted during
XXXX-XXXX. Due to the slow-growing nature of temperate forests,
including those in the Upper Midwest, we can think of the PLS data as
a snapshot of forest composition in time. 
%This is a unique data set that allows us better understand forest ecosystems

%XXX Chris...  
Survey data for the Upper Midwest has been recently digitized, and
aggregated to an 8km square grid \citep{XXX}. As a result of the
sampling methodology, this aggregation results in small numbers of
tree counts per grid cell. To overcome the variability arising from
this we work with a smoothed version of the PLS data, based on a
Bayesian spatial multinomial model \citep{paciorek_composition}. 

\subsection{Tree taxa}
We focus on a subset of 10 tree genera and 2 functional groups that
includes the most abundant taxa as well as less-abundant taxa of
particular ecological importance. Our modelled taxa are: ash, beech,
birch, elm, hemlock, maple, oak, pine, spruce, larch, as well as other
conifer and other hardwood groups.  These latter two groups include
other minor tree species identified by surveyors but not explicitly
included in the aforementioned list of taxa. The separation of other
hardwood and conifers follows the standard classification of tree
species into plant functional types in earth system and ecosystem
models \citep{cramer2001global, goring2015}. Additionally, the
separation of other hardwood and conifers allows the calibration model
to treat each group separately and tease out inherent differences
between conifer and deciduous pollen production, although the
variability in production and dispersal within each of these groups is
still large.

% This aggregation accelerates computational
% time, but also helps with model parameterization - reliable plant
% trait data is simple not available for all species.

\subsection{Pollen data}

With the push for robust and reproducible research from the scientific
community, paleoecoinformatics has responded with the development of
tools that make it possible to access and query large datasets. One
such tool that has made this work possible is the Neotoma database
(\url{neotomadb.org}; \citep{XXX}), which stores a variety of types of
paleoecological data, including pollen data. Accessing this data can
be done using the Neotoma API
(\url{http://apps.neotomadb.org/explorer/}), or using the R neotoma
package \citep{goring2015}. Using R neotoma we identifed 184 sediment
pollen cores in the Neotoma database in our spatial domain with the
restriction that these sediment cores include at least some pollen
samples believed to be from the last 2000 years. All of these pollen
cores were sampled at multiple depths, often regularly spaced, and are
hereafter referred to as long cores.

An additional 57 cores not available on Neotoma were contributed by
independent researchers \citep{kujawa2015}. Of these 57, 9 were long
cores (analogous to those from neotoma), while the remaining 48 had
only core top and pre-settlement samples (at least in the data file we
had access to), and are therefore referred to as short cores.

Associated with each of the cores is a table containing counts by
taxon for each sampled depth. These counts are not certain -
classifying pollen grains based on morphological features and relating
them to plant taxa is often challenging as a result of (differential)
preservation. Counts between palynologists for a single sample will
also differ, but for experts this difference should be negligible
\citep{XXX}.

One of the challenges that arises when working with pollen data
collected by several (or more) individuals is dealing with naming
inconsistencies in the pollen taxonomies between sites. Both differing
nomenclature and identified taxonomic resolution require that care be
taken when standardizing pollen taxonomies. There arise cases where it
may not be possible to associate certain pollen grains with plant
taxa, and in these cases grains may be identified to type
(e.g. Alnus-type), or placed into a group whose name is defined by
their morphology (e.g. tricolporate). In this study, decisions
regarding these poorly identified pollen grains were made on a
case-by-case basis, although the total number of grains that fell into
these ambiguous classes were few.

For each pollen core we are interested in the pre-settlement sample
that is closest in time to the PLS data collection date (which is
spatially varying). Typically, age-depth models are used to assign
ages to sample depths to sediment cores. However, age-depth modelling
is an uncertain process, with no consensus in the paleoecological
community on a single best model or method. Instead, we rely on a
panel of experts to interpret patterns in the pollen count data in
order to identify pre-settlement sample estimates. All 185 long cores were
suitable for this exercise.

\subsection{Identifying the EuroAmerican settlement horizon in pollen records via expert elicitation}
Widespread land clearance during European settlement provided habitat
for many non-arboreal colonizers, resulting in increases in
non-arboreal taxa in pollen time series \citep{mcandrews1988human}. In
the Upper Midwest, significant increases in ragweed
(\textit{Ambrosia}), docks and sorrels (\textit{Rumex}), and grasses
(\textit{Poaceae}) are typically coincident with this settlement
horizon. In principle, it is possible to identify the pre-settlement
sample - the sample that falls immediately before these increases in
agricultural indicator species. For many records the rises are sharp
and determining the pre-settlement sample is easy, while other records
are more ambiguous and placement relies on subjective judgment.

For this study, in the interest of reducing uncertainty, we want to:
1) identify pre-settlement samples using consistent methodology, and
2) assess the variability in assignment of pre-settlement among
analysts. To address these questions, we asked a team of expert
palynologists to identify the pre-settlement sample for 185 pollen
records. Experts were provided with pollen diagrams depicting
proportional changes through time as a function of depth for key
indicator species and the ten most abundant arboreal taxa. Experts
were prohibited from relying on stratigraphic dates (radiocarbon or
other) or age-depth model estimates of sample age. In the case that
there was no distinguishable pre-settlement sample, experts were
instructed to report NA. In the case that experts were uncertain about
their pre-settlement sample assignment, they were instructed to note
this, with or without justification. Results from this exercise are
used to define depths associated with pre-settlement samples. Pollen
samples associated with these depths are placed into our calibration
data set.

\section{Calibration model}

Here we describe the Bayesian hierarchical calibration model used to
quantify the pollen-vegetation relationship. For the sake of clarity,
we first provide an overview of the model, and then introduce the
mathematical notation.

The pollen counts that we observe are a function of the vegetation on
the landscape - the composition and abundance of trees on the
landscape determines (in part) the composition and abundance of pollen
that is deposited in the sediment. Determining how much pollen the
surrounding vegetation contributes is a complex function of forest
characteristics, climate (including wind), grain size and morphology,
topography, and proximity of the vegetation to a deposition basin.

We work on a grid defined by the resolution of the gridded PLS data,
and define each deposition site as having both local and non-local
pollen contributions. Local contributions are made by the vegetation
within the same grid cell as a site, and non-local contribution are
made by vegetation from all other grid cells in the domain. The
relative contributions of the local and non-local contributions are
determined by a model parameter, with the restriction that the sum of
all contributions from the pollen source area must sum to one.

Contributions from non-local grid cells are not all equal - their
relative contributions are weighted using a dispersal kernel, which
determines how likely it is for pollen to travel from one grid cell to
another. Dispersal kernels are typically isometric, meaning that they
depend only on the distance of the tree to the pond, and not the
absolute position or direction. In reality, dispersal is not
isometric, predominantly due to prevailing wind direction, but also as
a result of other asymmetries in surface roughness and landscape
structure. However, isometric dispersal kernels are are a reasonable
and widely used approximation, because turbulent atmospheric mixing
below the boundary layer tends to smooth out anisotropies.

Here we test two dispersal kernels: the Gaussian and the Inverse
power-law. The Gaussian kernel is often used as a reference against
more leptokurtic kernels such as the Inverse power law kernel, and can
represent dispersal through diffusion. Although the Gaussian kernel
has simpler mathematical representation, fatter-tailed kernels (such
as the Inverse power-law) in general perform better than those with
thinner tails (like the Gaussian or Exponential) when modelling pollen
dispersal \citep{devaux2007modelling, austerlitz2004using}. However,
dispersal data needed to validate pollen dispersal models are
generally unavailable, especially at the large spatial scales needed
to adequately test long-tailed kernels \citep{clobert2012dispersal}.

Here, we choose two kernels that are representative of the short- and
long-tail kernel classes, and compare between these generalized
functional forms.

%  Both the gaussian and inverse power law kernels have
% been successfully applied to pollen data ??.  

To determine the total non-local contribution, we sum the
contributions of all grid cells in the domain that do not contain a
given pond, where a contribution is equal to the weight assigned by
the kernel multiplied with the vegetation proportion at that grid
cell. Then, we sum the local and non-local contributions to obtain a
single vector of proportions that represent the effective contributing
vegetation. Finally, each component of this vector is scaled by a
taxon-specific parameter ($\gamma$) that accounts for differential
production of pollen among plant species.

\subsection{Model description}

As previously mentioned, the spatial domain is defined as a regular
grid composed of 8 km square grid cells. The grid is composed of
discrete cells, but the underlying vegetation composition and
dispersal spatial processes are assumed to be smooth. Spatial cells
are indexed by $s=1,\ldots,S$, where $S=8013$.

Pollen produced by vegetation within each grid cell can be deposited
locally within that same grid cell, or can be dispersed into the
neighborhood around that grid cell. For a focal grid cell
$s_i$, the pollen produced by taxon $p$ within that cell that remains
local is described by

\begin{align}
\gamma \phi_p r_p(s_i)
\end{align} 

where $\gamma$ is the proportion of pollen produced in $s_i$ that is deposited locally,
$\phi_p$ is the scaling factor that accounts for differential
production, and $r_p(s_i)$ is the proportional abundance of taxon $p$
in $s_i$.

The remaining proportion ($1-\gamma$) of pollen produced in $s_i$ is
dispersed to other grid cells according to an isotropic dispersal
kernel centered at $s_i$. The dispersal kernel weights all pollen
dispersing away from the focal cell as a function of the distance from
$s_i$ to any neighboring cell $s_k$ by $w(s_i, s_k)$. 

The two dispersal kernels considered here are: (i) the Gaussian and
(ii) the Inverse power-law.

The Gaussian kernel, denoted $w_g(s_i,s_k)$, is written as
\begin{align}
w_g(s_i, s_k) = \exp\left( - \frac{d(s_i, s_k)^2}{\psi^2} \right),
\end{align}
where $d(s_i,s_k)$ defines the distance between cells $s_i$ and $s_k$
and $\psi>0$ is a parameter that describes the spread of the kernel. 

The Inverse power-law kernel, denoted by $w_{pl}(s_i,s_k)$, is given by
\begin{align}
w_{pl}(s_i, s_k) = \frac{(b-2)(b-1)}{2 \pi a^2} \left( 1 + \frac{d(s_i, s_k)}{a} \right)^{-b},
\end{align}
where $a>0$ and $b>2$ are parameters that determine the kernel shape. 

As expected, the weight assigned by both kernels is a decreasing function
of distance - less pollen is distributed farther away.

%Previous work has shown that pollen dispersal distances can reach up to XXXX, and that long-distance dispersal events may be rare, but have the ability to drive range expansion XXX.
 
We can then define the pollen produced by taxon $p$ dispersing from
$s_i$ to $s_k$ by
\begin{align}
(1-\gamma) \phi_p r_p(s_i) w(s_i, s_k).
\end{align}

% We can then define the pollen produced by taxon $p$ dispersing from
% $s_i$ to $s_k$ by
% \begin{align}
% \frac{1}{C} (1-\gamma) \phi_p r_p(s_i) w(s_i, s_k),
% \end{align}
% where $C$ is a normalizing constant equal to the sum of the weights of
% all the cells to which pollen can be dispersed, defined be a
% rectangular region that covers and extends beyond the limits of the domain.

%% An anisotropic kernel may better approximate true pollen dispersal due to prevailing winds, although prevailing wind direction in the Upper Midwest is not constant throughout the domain due to the proximity to the great lakes, making the inclusion of this asymmetry complicated. %

%and therefore including this non-constant asymmetry in the modeling framework is not straightforward. 

So far we have characterized the model from a source-based
perspective, describing how pollen produced in grid cells is
dispersed. We would like to quantify the pollen arriving at pond $i$
located in the grid cell $s(i)$ - our data is counts of pollen grains
that have been deposited in the sediment. This arriving pollen is
equal to the sum of the contributions from all cells in the domain to
the pollen pool in $s(i)$, which includes both the locally deposited
pollen plus the pollen dispersed to $s(i)$ from all other grid cells
in the domain. Therefore the pollen from taxon $p$ arriving at pond
$i$, referred to as $r_{i,p}^{\text{pol}}$, is given by
\begin{align}
r_{i,p}^{\text{pol}} = \gamma \phi_p r_p\bigl(s(i)\bigr) + \frac{1}{C} (1-\gamma) \phi_p \sum_{s_k \neq s(i) } r_p(s_k) w\bigl(s(i), s_k\bigr),
\label{eq:arriving}
\end{align}
where $C$ is a normalizing constant equal to the sum of the weights of
all the cells to which pollen can be dispersed, defined be a
rectangular region that covers and extends beyond the limits of the
domain.

Finally, we need to relate the arriving pollen $r_{i,p}^{\text{pol}}$
quantified in Equation~\ref{eq:arriving} to the pollen count data. To
do this, we must consider that the pollen data are overdispersed - the
counts are more variable than we might expect if they were assumed to
follow a multinomial distribution. This overdispersion is mostly
attributed to heterogeneity in the pollen production and dispersal
processes that is not accounted for in our mathematical
characterization, but is also an artifact of comparing pollen counts
at a point location (the pond) situated anywhere within a focal grid
cell to a grid-based vegetation composition average. To account for
this overdispersion, we model the pollen counts at pond $i$, denoted
by $\bm{y}_i$, as dirichlet-multinomial (DM), which is a compound
distribution used to account for overdispersion in multinomial count
data (and tends to the multinomial distribution in the case of no
overdispersion). We have that
\begin{align}
\bm{y}_i \sim DM (n_i, \bm{r}_i^{\text{pol}})
\label{eq:DM}
\end{align}
and $\bm{r}_i^{\text{pol}} = (r_{i,1}^{\text{pol}}, \ldots,
r_{i,K}^{\text{pol}})$.  The precision $\alpha_i$ is equal to the sum
of (\ref{eq:arriving}) over all taxa
\begin{align}
\alpha_i = \sum_{p=1}^K \Bigl[\gamma \phi_p r_p\bigl(s(i)\bigr) + \frac{1}{C} (1-\gamma) \phi_p \sum_{s_k \neq s(i) } r_p(s_k) w\bigl(s(i), s_k\bigr)\Bigr].
\label{eq:alpha}
\end{align}
The precision parameter $\alpha_i$ is also affected by the proximity
of a lake to the domain boundary. We do not have data outside of the
defined domain, so cannot quantify the pollen dispersed from
vegetation outside the domain to lakes situated close to the
boundary. The repercussion of this is that the sum of the weights of
the grid cells contributing pollen to a focal cell close to the domain
boundary is less than the sum of the weights of the total potential
contributing neighborhood, defined as C. As a result of having a
reduced contributing neighborhood, the local pollen contribution is
effectively up-weighted relative to the non-local contribution (see
Eqn.~\ref{eq:alpha} ).

\subsection{Model priors}

We assign uninformative uniform priors to model parameters over wide
intervals. We define the priors $\phi_k \sim \text{uniform}(0, 300)$ for
$k=1, \ldots, K$ and $\gamma \sim \text{uniform}(0,1)$. In the case of the
Gaussian kernel we define the prior $\psi ~ \text{uniform}(0, 2)$, while in
the power law kernel case we have $a ~ \text{uniform}(0, 500)$ and
$b~\text{uniform}(2, 100)$.

\subsection{Model variants}

As described above, neither dispersal kernel ($w_{pl}$ or $w_g$) nor
the parameter $\gamma$ vary by taxon. In this base variant, a single
dispersal kernel defines how all pollen disperses, and a single
parameter determines what proportions of total pollen of any given
taxon remains local. We know that in reality pollen dispersal varies
with taxon, because pollen grain morphology, size, weight, and
preservability are all highly variable among plant taxa. Here, we let
the data inform us as to whether there is sufficient evidence to
support taxon-specific dispersal kernels and localness parameters
through the use of exchangeable priors ?. So, we define the same prior
distribution on each of the $K$ parameters in question, where the prior
distribution is defined by shared hyperparameters. In the case where
the variance hyperparameter is estimated to be relatively close to
zero, we can conclude that there is not sufficient evidence to suggest
that the parameter of interest varies by taxon.

For example, in the Gaussian kernel case we would like to know
if there is enough support to warrant taxon specific values of
$\phi$. We define the exchangeable priors for taxon $k=1, \ldots, K$
\begin{align}
\log(\psi_k) \sim \text{normal}( \mu, \sigma)
\end{align}
where the prior on $\mu$ is uniform over the log of the prior interval
used in the single-taxon case for $\psi$, and the prior for $\sigma$
is a half-Cauchy with mean of 0 and standard deviation of 2. In the
Power law kernel case, when we let $a$ and/or $b$ vary, their
exchangeable priors are analogous to the $\psi$ case. Note that in the
Power law case, $b$ is allowed to vary by taxon when $a$ varies by taxon.

In the variable gamma case, we define a logit-normal prior for each
$\gamma_k$, where $\mu_{\gamma} \sim \text{uniform}(-2, 2)$ and $\sigma_{\gamma}
\sim \text{Cauchy}(0,5)$ defined on $[0,\infty)$.

Allowing $\gamma$ and/or the kernel to vary by taxon results in a
total of 10 model variations as described in Table~\ref{table:WAIC}.

\subsection{Model comparison}

To identify the set of candidate models, we first assessed the
variance estimates for the exchangeable priors. In the case where
there was insufficient evidence to support the case for taxon-specific
parameters, as indicated by (i) an estimated variance close to zero
and (ii) overlapping credible intervals for the posterior
distributions of the taxon-specific parameters, the model was not
considered as a candidate model.

Then to determine which kernel and model best fit the data set we
perform a formal model comparison using the Wantanabe-Akaike
Information Criterion (WAIC) \citep{watanabe2010asymptotic}. The WAIC
provides a relative measure of loss of information (as does the more
familiar AIC) in a Bayesian context, avoiding the necessity of
determining the number of model parameters (as required by AIC) while
accounting for the full posterior distribution as opposed to
conditioning on a single point estimate (as in AIC and DIC)
\citep{gelman2014understanding}.

\subsection{Numerical implementation}

We cannot directly sample from the joint posterior, so we rely on MCMC
methods. With the goal of achieving more efficient sampling with
respect to the effective sample size per unit time, we used the Stan
statistical modeling software to estimate parameters
\citep{stan-software:2014}. Stan implements a variant of the
Hamiltonian Monte Carlo method called the No-U-Turn Sampler, which is
a gradient based sampling method that uses these directional
derivatives to make informed decisions about how to move along (and
sample from) the joint posterior surface \citep{hoffman2011nuts}.

% Our model was coded in the Stan bugs-like language, then converted
% to C++ code using the Stan translator, compiled using GCC, and run
% on an Intel XXXX.

% HMC can be more efficient that a traditional MCMC
% in many cases, but requires additional tuning that is difficult to
% perform in practice, as well as user defined gradients that can be
% difficult to impossible to compute analytically. NUTS overcomes the
% tuning issues by extending the HMC algorithm to including automatic
% tuning. Stan provides an implementation of the NUTS sampler that uses
% automatic differentiation to compute model gradients, making the
% sampler accessible to anyone able to program their model using a
% bugs-like syntax.

\section{Results}

\subsection{Expert elicitation of biostratigraphic evidence for European settlement and site suitability}

Four experts participated in the elicitation exercise. For 59 out of
185 sites, the experts were in total agreement: they all identified
the same pre-settlement sample (53 cases) or agreed that no such
sample could be identified (6 cases). The remaining sites varied in
level of disagreement - in 79 cases, experts identified two samples;
in 39 cases 3 pre-settlement samples were identified; and in 8 cases
there was no agreement. These results confirm our hypothesis that
identification of biostratigraphic markers is subject to variability
between analysts and is the first to quantify this uncertainty.

Of the 6 sites that experts agreed had no discernible settlement
signal, two of these sites were at Rice Lake, which is an anomalous
site overwhelmed by a wild rice (\textit{Zizania}) and grass
(\textit{Poaceae}) signal, and does not show any indication of
settlement. The remaining four included: Rossburg peat bog in
Minnesota; Disterhaft Farm Bog in Wisconsin; Kirchner Marsh in
Minnesota; and Stewart’s Dark Lake in Wisconsin. Three of these four
sites are bogs and marshes with local marshland non-arboreal plants
growing at or near the coring location; these marshland plants may be
swamping the signal from agricultural non-arboreal indicators.

Based on these results, we were subsequently faced with the challenge
of establishing site suitability criteria to determine which sites to
include in the calibration data set. Ideally, the now quantified
pre-settlement sample uncertainty would be included into the modelling
framework, but this option was rejected for now in favor of simplicity
of the statistical model. Instead, we set rules for filtering suitable
sites and assigning pre-settlement depths on expert determinations.

Based on these results, we were subsequently faced with the challenge
of establishing site suitability criteria to determine which sites to
include in the calibration data set. Ideally, the now quantified
pre-settlement sample uncertainty would be included into the modelling
framework. Although this is surely possible, it would increase the
complexity of the statistical model. For the sake of simplicity, we
filter suitable sites and assign pre-settlement depths in a systematic
way based on expert determinations.

% However, this elicitation exercise varies from those that
% are typically conducted to construct priors; here we are uncertain
% about our data, not our parameters. Instead of increasing the
% complexity of the statistical model, we filter suitable sites and
% assign pre-settlement depths in a systematic way based on the expert
% determinations.

Sites were considered unsuitable if: 1) a majority chose not to assign
a pre-settlement sample (12 sites), or 2) if half of the experts chose
not to assign a pre-settlement sample and the remaining half
identified pre-settlement samples whose modelled ages were “far” from
the approximate time of settlement (7 sites). For this second
criterion, we looked to existing age-depth models associated with the
pollen cores. Modelled ages for the identified pre-settlement depths
were compared to 1850 AD, which serves as an approximate year of
settlement in the upper Midwest.  Modeled ages were defined to be far
from the expert-identified settlement horizon if discrepancies were
>500 years All 19 unsuitable sites were excluded from further
analysis.

After completion of the elicitation exercise, a follow-up examination
of the stratigraphic data revealed several cores with core tops with
dates much older than expected - typically the date of a true core top
corresponds with the year of sampling (with some margin of
error). Further investigation uncovered that three of the cores
included in our analysis were missing core tops. For both Lake Mary
and Green Lake, we determined that the core tops pre-date settlement,
and these sites were therefore were discarded \citep{webb1971late,
  lawrenz1975}. A third site, Lake Kotiranta, had a core top
corresponding to the pre-settlement sample, and this sample was
retained for inclusion in the calibration data set
\citep{wright1969}. Interestingly, for each of these cores, 1-3
experts identified a pre-settlement sample (although to be fair, they
made this judgment based solely on the stratigraphic diagram and no
information about site characteristics, and likely assumed that the
uppermost sample was in fact a surface sample).

After the suitability screening, we were left with 165 long cores. For
many cores, there was no consensus, which left us to determine how to
assign our best estimate of pre-settlement. Given the sample
resolution and an even number of experts, neither the mean nor the
median were options. Keeping in mind that we would rather err on the
side of caution and choose a depth that was more certainly
pre-settlement (deeper) than one that represented post-disturbance
times (more shallow), we ordered the sample depths from deepest to
shallowest, and selected the second in this list (typically the second
deepest, although sometimes the two largest sample depths were equal).
The additional 48 short cores from the Calcote dataset were not
candidates for the elicitation exercise because they had only a core
top and a pre-settlement sample recorded. The decision to include this
additional data in the calibration data set was debated - the
pre-settlement samples for these cores were identified using different
methodology (and analysts) than the remaining sites. In the end, we
opted to include these samples as part of the calibration data set,
based on our confidence in the data set and analysts and the
recognition that including these sites would result in a substantive
increase in sample size. In total we had 213 pollen samples in the
Upper Midwest settlement-era calibration data set.

\subsection{Exploratory data analysis}

To visually assess the relationship between sediment pollen and tree
taxa, we compare pie maps which depict the relative proportions of
taxa across space (Figure~\ref{fig:pie}). In these maps the broadscale
patterns are consistent with each other, with both pollen and PLS data
capturing the major ecotones in the region
\citep{solomon1985computer}.  However, there are some striking
differences. First, pine dominates the pollen records for most of the
northern half of the domain. Second, in the vegetation composition
data, some regions that have higher relative abundances of Hemlock,
Tamarack, and Maple are not apparent or much less pronounced in the
pollen data. These taxa are known to be underrepresented in the pollen
record \citep{XXX}. As expected, these pictures confirm that pollen is able
to capture key vegetational gradients, but that the relationship
between pollen and vegetation is complex.

To further assess spatial distributions of pollen versus PLS data, we
plot the data as heat maps by taxon. Differences in extent of these
distributions indicate pollen dispersal beyond species range
limits. For example, for both birch and pine, both of which are known
to be overrepresented in pollen records, the distributions of sediment
pollen extend well beyond the boundaries of those shown in the PLS
data (Figures~\ref{fig:compare_maps_PINE} \&
\ref{fig:compare_maps_BIRCH}).

\subsection{Modelling results}

%\subsubsection{Posterior sampling and model selection}
A total of ten models were considered - four with the Gaussian kernel,
and six with the power-law kernel. For each model, three chains were
run with a warm-up of 250 iterations, followed by a sampling period of
10,000 iterations. Warm-up iterations were not used in further
analysis. For a total of 30,000 iterations per model, the effective
sample sizes of the joint log posterior ranged from 12,247 for the
Gaussian kernel base model to XXXX for the XXX model. Effective sample
sizes for the joint log posterior and parameter posteriors are given
in Table~\ref{XXXX}. Trace plots for the joint log posterior show the
efficient mixing achieved by the sampler (See Figure~\ref{fig:trace}
for trace plots from the Gaussian dispersed model; trace plots of
other models show similar mixing, and are therefore omitted).

To compare among models, we first assess the estimates of the
hyperparameters for the exchangeable priors. All parameter and
hyperparameter estimates support the use of taxon-specific parameter
values, except for the power-law models which allow $b$ to vary by
taxon. In these cases, the estimated variance for the exchangeable
prior for $\log ( b )$ is small (9e-6 for the variable $a$ and $b$ case;
1e-4 for the variable $a$, $b$, and gamma case). In addition, the 95 \%
credible intervals for the estimate of $b_k$ for all $k$ overlap,
supporting the conclusion that the values of $b_k$ are not
statistically different. In light of this, we reject these two
power-law kernel variable $b$ models. 

Out of the remaining eight candidate models (four with the Gaussian
kernel; four with the power-law kernel) we compare the WAIC
(Table~\ref{table:WAIC}). According to the WAIC the power law kernel
outperforms the Gaussian kernel - even the most flexible Gaussian
model (variable $\psi$ and $\gamma$) results in a WAIC that is higher
than the least flexible power law kernel model (base model). The power
law kernel model with variable $a$ and $\gamma$ results in the lowest
WAIC, indicating that it performs the best out of the suite of
considered models. However, it is still of interest to make further
comparisons between the two kernels - does the kernel formulation make
a noticeable different in pollen production estimates and pollen
predictions? One of the goals of this work is to use the calibrated
pollen-vegetation relationship to estimate vegetation composition back
through time, and therefore it is natural to think about how kernel
selection affects predictions, if at all.

In light of this, we continue to compare the two base models (Gaussian
and power law), as well as the models with the lowest WAIC for each
kernel type - the Gaussian variable $\psi$ and $\gamma$ model and the
power law variable $a$ and $\gamma$ model (hereafter referred to as
the Gaussian or power law variable models).

In Figure~\ref{fig:focal_scaled}, the raw pollen proportions are
plotted against the vegetation proportions for each grid cell (red
crosses). The relationship between the pollen and vegetation is
clearly not 1:1. In particular, we see that some taxa, such as beech,
maple, other conifer, and tamarack, are not prolific pollen producers
- they can appear in large proportions on the landscape, but never
appear in large proportion in the pollen record. Some relationships
are difficult to identify, for example pine, where it varies from
sparse to abundant on the local landscape, but this relative
composition provides little indication about the relative abundance of
pine pollen.

These relationships are complicated in part because of differential
pollen production, which the calibration modelaccounts for by the
taxon-specific scaling parameter $\phi_k$. After scaling the local
vegetation in a cell by $\phi_k$, we can again compare the raw pollen
proportions with these pollen predictions
(Figure~\ref{fig:focal_scaled}; black and blue dots). Here we show
predictions only the variable gaussian and power law models, but note
that the results are similar for the base models. Scaling by $\phi$
does improve our pollen estimates; for many taxa, the black points
have shifted towards the 1:1 line. This is especially true for maple,
tamarack, and other conifer, suggesting that these pollen-vegetation
relationships are heavily influenced by local pollen sources. However,
for most of the remaining taxa the improvement is minimal, indicating
that simply scaling the local vegetation proportions is not sufficient
to predict deposited pollen.

In Figure~\ref{fig:preds}, we again plot the raw pollen proportions
against both the vegetation (red crosses) and predicted pollen for the
variable models (Gaussian: black dots; power law: blue dots), but in
this case the predicted pollen is based on the local plus non-local
predictions obtained from the full calibration model. Now that
non-local dispersal has been accounted for, the raw versus predicted
pollen points fall more closely along the 1:1 line. This indicates
that in our domain non-local dispersal processes account for much of
the pollen that arrive at any given location. For most taxa, the
improvement that we gain by using more flexible models versus the base
models is not qualitatively obvious. This is not true for Hemlock -
both base models underpredict Hemlock pollen at sites where there is
relatively high proportion of Hemlock (although Hemlock pollen never
exceeds 28\% at any site in our domain). This suggests that the
relative contribution of local versus non-local hemlock pollen is
estimated to be less than the true value, i.e. $\gamma$ is too small.


In Figure~\ref{fig:preds}, we again plot the raw pollen proportions
against both the vegetation (red crosses) and predicted pollen for the
variable models (guassian: black dots; power law: blue dots) by taxon,
but in this case the predicted pollen is based on the local plus
non-local predictions obtained from the full calibration model. Now
that dispersal has been accounted for, we see that the raw versus
predicted pollen points fall more closely along the 1:1 line. This
indicates that in our domain dispersal processes account for much of
the pollen that arrive at any given location. For most taxa, the
improvement that we gain by using more flexible models versus the base
models is not qualitatively obvious. This is not true for Hemlock -
both base models underpredict Hemlock pollen at sites where there is
relatively high proportion of Hemlock (although Hemlock pollen never
exceeds 28\% at any site in our domain). This suggests that the
relative contribution of local versus non-local pollen is estimated to
be less than it should be, i.e. $\gamma$ is too small.

There are two anomalous sites for which the model is unable to
adequately account for the processes leading to the (relatively
speaking) unusual compositional makeup of the deposited pollen. The
first is Ocheda Lake, a large but shallow glacial kettle lake in
Southwestern Minnesota. The pollen diagrams indicate a relative spike
in deposited Maple pollen in the pre-settlement sample. The second is
Tamarack Creek, a site situated in a wetland with high Tamarack pollen
counts for the top 80 cm of sediment. At this site, the calibration
sample is composed of 40 \% Tamarack, while all other fossil pollen
sites contain a maximum of 1 \% Tamarack.

From each model we obtain taxon-specific estimates for the ratio of
local to non-local pollen $\phi$ (Figure~\ref{fig:phi}). If these
parameter estimates truly represent differential pollen
production/dispersal, then these estimated values should be consistent
across model variants, which is generally the case
(Figure~\ref{fig:phi}). However, for several taxa including beech,
Hemlock and Pine the variable power law kernel models predicts much
larger $\phi$ values than the other models. However, in some of these
cases the credible intervals are large, and overlap with competing
estimates of $\phi$, suggesting that these estimates may not be
statistically different. Aside from the few uncertain values resulting
from the variable power law model, the estimated values of $\phi$ form
three distinct groups in $\phi$ parameter space: low, intermediate,
and high production/dispersal (Figure~\ref{fig:phi}). The group of
taxa with lowest production/dispersal in decreasing order are beech,
maple, other conifer, and tamarack. This low production/dispersal
pattern is evident in Figure~\ref{fig:preds}, where the representation
of these taxa in the pollen records is consistently less than their
representation on the landscape (except at a few anomalous
ponds). Intermediate producers/dispersers, again in decreasing order,
include other hardwood, oak, elm, hemlock, ash, and spruce. The high
production/dispersal group includes pine and birch, which can also be
seen in Figure~\ref{fig:preds} by their propensity to be
over-represented in the pollen record relative to the landscape. These
results agree in general with \citep{prentice1986}, which analyzed the
pollen-vegetation relationship for sites in Wisconsin and the Upper
Peninsula of Michigan. In that work, pine and birch had the largest
slopes (top producers/dispersers), and maple and tamarack as limited
producers/dispersers. \citep{jackson1990} also found that Pine and
Birch were good dispersers with effective source areas of 1000m, while
Maple was found to have a much smaller source area indicating limited
dispersal.

For the base models, the local versus non-local weight parameter
$\gamma$ was estimated to have a mean of $0.21$ for the Gaussian
kernel model and $0.07$ for the power law kernel model. These values
indicate that 21\% (or 7\%) of the pollen produced by vegetation in a
focal grid cell is deposited in that grid cell, while the remaining
79\% (or 93\%) disperses elsewhere in the domain.

When we allowed $\gamma$ to vary by taxon in the variable models, the
estimates for both kernels yielded similar results with overlapping 95
\% credible intervals for all taxa except Pine and Oak
(Table~\ref{table:gamma}). Birch, Other conifer, Ash, and Other
hardwood all had lower estimates of $\gamma$, with mean posterior
values all less than 0.12 (mean values ranging from 0.03 -
0.11). Those taxa with larger estimated values of $\gamma$ were
Hemlock, Tamarack, Maple, Beech, Spruce, and Elm. For both Pine and
Oak, the variable Gaussian kernel models estimated higher values of
$\gamma$. It is encouraging that these estimates of localness are
similar for both variable case models, but based on these estimates
alone we can compare only focal-cell contributions. Non-local
dispersal is determined by the product of $(1-\gamma)$ with the sum of
the weights of all non-local cells, which in turn depends on the
estimated kernel parameter(s).

For the base Gaussian kernel case, the spread parameter $\psi$ was
estimated to be $204\,(192, 215)$ km. In the variable Gaussian model
$\psi$ estimates ranged from 152 for Pine to 361 for Other hardwood
(Figure~\ref{fig:XXX}). For many taxa, 95\% credible intervals are large;
this is especially true for Tamarack, with a credible interval of
(128, 553). For the base power law model, the kernel parameters $a$
and $b$ were estimated to be $0.01\,(8.29e-3, 0.01)$ and $2.03\,(2.00,
2.12)$. For the variable power law model case, the estimated $b$ value
was almost identical to the base model $2.06\,(2.00, 2.16)$. The $a$
estimates ranged from $2.68e-3$ for Beech to $0.203$ for Elm.

The most intuitive way to assess how these parameters affect pollen
dispersal is to plot the proportion of deposited pollen as a function
of radius from the pollen source. So, we plot $\gamma + (1- \gamma)
\sum_{s_j \neq s_i} w(s(i), s_j)$ for a hypothetical core ($i$)
centered on our potential discretized domain, where for a defined
radius, cells are included in the non-local sum if the distance
between $s(i)$ and $s_j$ is less than or equal to this radius. Then,
for each taxon, we can plot cumulative density functions of the
deposited pollen for each of the four considered models
(Figure~\ref{fig:XXX}). We note that the plotted based model functions
are identical for all taxa (solid lines).  For the variable models, we
can see the effects of changes in magnitude in both $\psi$ for the
Gaussian kernel, and $a$ for the variable kernel. The CDFs for the
Gaussian kernel models all have a sigmoidal shape, where smaller
values of $\psi$ correspond to a steeper slope indicating that
relatively more pollen deposition happens close to the source. The
contrast between the two most extreme $\psi$ values is seen the Pine
(lowest) and Other hardwood (highest) variable Gaussian CDFs. For the
variable power law model, for fixed $b$, larger values of $a$ result
in a more sigmoidal shape that resembles the Gaussian kernel, for
example as seen with Elm where the variable model CDFs are nearly
identical. Again for fixed $b$, smaller values of $a$ results in a
concave downward curve that shows that pollen is deposited closer to
the source, but at a certain distance from the source - where the
Gaussian and power law CDFs intersect - the cumulative pollen
deposition is equal. To help interpret these curves, we determined the
radius from the source needed to capture 50\% and 90\% of the
deposited pollen for each model and each taxon
(Table~\ref{table:pollen_acc}). As seen in Figure~\ref{fig:cdf}, the
CDFs for the two base models have two points of intersection,
indicating changing relative rates of accumulation. The power law
based model estimates a smaller radius needed to accumulate 50\% of
the pollen, however, the Gaussian base model cdf asymptotes to one
more quickly (shorter-tailed kernel). For the variable models, the
taxon with the smallest radius from a pollen source needed to
accumulate 50\% of the dispersed pollen was Hemlock (60 km for the
variable Gaussian, and 28 km for the the variable power law), while
Other hardwood required the largest radius to accumulate the same
percent (264 km for the variable Gaussian, 252 km for the variable
power law). To capture 90\% of the dispersed pollen required radii of
216 km for Pine up to 448 km for Other hardwood for the variable
Gaussian model, and 292 km for Hemlock to 476 km for Elm and Other
hardwood for the variable power law model.

% To assess the assumption that all taxa share a dispersal kernel with
% spread controlled by the scalar $\psi$, we re-ran the model letting
% $\psi$ vary by taxon. Five of the taxon-specific 95\% credible
% intervals had some overlap with the credible intervals for the
% single-$\psi$ case, while the remaining taxa had estimated $\psi$
% value that were larger (Figure~\ref{fig:psi_vary_psi}). Elm, Tamarack,
% Maple, and Ash had the largest mean value of $\psi$, although the
% uncertainty of these estimates was large - for example, for Tamarack
% the mean value and credible interval of $\psi$ was $0.73 (0.10,
% 1.9)$. When we let $\psi$ vary by taxon, there was little effect on
% the values of $\phi$. The ordering of the taxa remained identical,
% except for a minor switch in position of Oak with Elm
% (Figure~\ref{fig:phi_vary_psi}). XXX: I don't get the dispersal pars
% for elm, tam, maple, ash - why are these so big?

% On average, Maple had by far the
% largest value of $\psi$, followed by Other hardwood, which implies
% that these two taxonomic groups are disperse the farthest. However,
% the 95\% credible interval for $\psi$ for Maple was wide, and in both
% cases the increased value of $\psi$ corresponded with an increased
% value of $\phi$ relative to the single-$\psi$ runs
% (Figure~\ref{fig:phi_vary_psi}). This indicates that there may be
% some issues with parameter identifiability inherent in the model when
% we allow $\psi$ to vary by taxon, and as such results from this run
% should be interepreted with caution.


To visualize the dispersal patterns predicted by our model, we can
estimate the proportion of deposited pollen by taxon for each grid
cell in the domain (previously we were estimating deposited pollen
only at lakes for which we had pollen data)
(Figures~\ref{fig:maps_pollen} \& \ref{fig:maps_pollen_pl}). These
spatial maps help us understand how the models treat
dispersal. Comparing these two figures illustrates the differences
between these two models - the predicted sediment pollen maps for the
variable power law model are much smoother. This is due to the
increased accumulation of dispersed pollen at short distances relative
to the Gaussian, which predicts that the fastest accumulation rate of
dispersed pollen occurs farther from the source (see
Figure~\ref{fig:cdf}).


We can also compare the predicted pollen maps with those depicting the
relative tree abundance (Figure~\ref{fig:maps_veg}), remembering that
the pollen predictions have been scaled to account for differential
production (so we are comparing predicted sediment pollen with
vegetation composition). This scaling for differential production is
particularly apparent for Tamarack. We know from the data that
Tamarack pollen proportions are always lower than the vegetation
proportions, and as a result, we expect that the model will predict
low amounts of Tamarack pollen, which it does. To see how the model
predicts dispersal by taxon, based on parameters estimated from that
data, we can compare the vegetation and pollen ranges. The effects of
dispersal are especially clear in the Pine and Oak cases, where we see
pollen dispersing well beyond the range limits of the vegetation range
boundaries.

\section{Summary and Conclusions}

\include{tables}
\include{figures}

\bibliography{calibration}

\end{document}
